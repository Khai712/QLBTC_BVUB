<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="admin/fragments/head :: head"></head>

<body>

<!-- Page wrapper start -->
<div class="page-wrapper">

    <!-- Sidebar wrapper start -->
    <div th:replace="admin/fragments/sidebar :: sidebar"></div>
    <!-- Sidebar wrapper end -->

    <!-- Page content start  -->
    <div class="page-content">

        <!-- Header start -->
        <div th:replace="admin/fragments/header :: header"></div>
        <!-- Header end -->

        <!-- Page header start -->
        <div class="page-header">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">Home</li>
            </ol>

            <ul class="app-actions">
                <li>
                    <a href="#" id="reportrange">
                        <span class="range-text"></span>
                        <i class="icon-chevron-down"></i>
                    </a>
                </li>
                <li>
                    <a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Print">
                        <i class="icon-print"></i>
                    </a>
                </li>
                <li>
                    <a href="#" data-toggle="tooltip" data-placement="top" title=""
                       data-original-title="Download CSV">
                        <i class="icon-cloud_download"></i>
                    </a>
                </li>
            </ul>
        </div>
        <!-- Page header end -->

        <!-- Main container start -->
        <div class="main-container">

            <!-- Row start -->
            <div class="row gutters">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            <!-- Row start -->
                            <div class="row gutters">
                                <div class="col-sm-12">
                                    <div class="table-container">
                                        <div class="t-header">Danh Sách Các Mục</div>
                                        <div class="table-responsive">
                                            <table id="basicExample" class="table custom-table">
                                                <thead>
                                                <tr>
                                                    <th scope="col">STT</th>
                                                    <th scope="col">Phần</th>
                                                    <th scope="col">Chương</th>
                                                    <th scope="col">Mục</th>
                                                    <th scope="col">Nội Dung</th>
                                                    <th scope="col">Đánh Giá</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr th:each="danhGia, iterStat : ${danhgias}">
                                                    <td scope="row" th:text="${iterStat.index + 1}"></td>
                                                    <td th:text="${danhGia.tieuMuc.tcChuong.tcPhan.maphan}"></td>
                                                    <td th:text="${danhGia.tieuMuc.tcChuong.machuong}"></td>
                                                    <td th:text="${danhGia.tieuMuc.matieumuc}"></td>
                                                    <td th:text="${danhGia.tieuMuc.noidung}"></td>
                                                    <td>
                                                        <button type="button" class="btn btn-detail card-title"
                                                                data-toggle="modal"
                                                                data-target="#evaluationModal" th:data-id="${danhGia.tieuMuc.id}">
                                                            Bằng Chứng
                                                        </button>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Row end -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Row end -->

            <!-- Modal Select Content Evaluation Single -->

            <div class="modal fade " id="evaluationModal" tabindex="-1"
                 role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
            <div th:replace="admin/fragments/modalContent :: modalContentFragment"></div>
                    </div>
                </div>
            </div>
            <!-- Modal Select Content Evaluation Single ends-->

            <div class="row gutters">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="toggle-icons lg" id="toggleIcons">
                                <div class="accordion-container">
                                    <div class="accordion-header" id="toggleIconsTwo">
                                        <button class="btn btn-detail card-title" data-toggle="collapse"
                                                data-target="#toggleIconsCollapseTwo" aria-expanded="true"
                                                aria-controls="toggleIconsCollapseTwo">
                                            Collab
                                        </button>
                                    </div>
                                    <div id="toggleIconsCollapseTwo" class="collapse" aria-labelledby="toggleIconsTwo"
                                         data-parent="#toggleIcons">
                                        <div class="accordion-body">
                                            <div class="col-sm-12">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <div class="row gutters">
                                                            <div class="col-sm-4 col-12">
                                                                <div class="form-group">
                                                                    <div class="card-title">Select Department</div>
                                                                    <select class="form-control selectpicker">
                                                                        <option>Information Technology</option>
                                                                        <option>Pharmacy</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-4 col-12">
                                                                <div class="form-group">
                                                                    <div class="card-title">Select Part</div>
                                                                    <select class="form-control selectpicker">
                                                                        <option>A</option>
                                                                        <option>B</option>
                                                                        <option>C</option>
                                                                        <option>D</option>
                                                                        <option>E</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-4 col-12">
                                                                <div class="form-group">
                                                                    <div class="card-title">Select Chapter</div>
                                                                    <select class="form-control selectpicker">
                                                                        <option>A1</option>
                                                                        <option>A2</option>
                                                                        <option>A3</option>
                                                                        <option>A4</option>
                                                                        <option>A5</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-4 col-12">
                                                                <div class="form-group">
                                                                    <div class="card-title">Select Item</div>
                                                                    <select class="form-control selectpicker">
                                                                        <option>A1.1</option>
                                                                        <option>A1.2</option>
                                                                        <option>A1.3</option>
                                                                        <option>A1.4</option>
                                                                        <option>A1.5</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-4 col-12">
                                                                <button type="button" class="btn btn-detail card-title" data-toggle="modal" data-target=".bd-example-modal-xl">Select
                                                                    Content Evaluation Collab
                                                                </button>
                                                                <button class="btn btn-detail card-title">Save</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- Main container end -->

    </div>
    <!-- Page content end -->

</div>
<!-- Page wrapper end -->

<!-- Include fragment script -->
<div th:replace="admin/fragments/script :: script"></div>

<!-- jQuery and Bootstrap -->
<script type="text/javascript">
    $(document).ready(function() {
        $('.btn-detail').click(function() {
            var tieuMucId = $(this).data('id');
            console.log("Button clicked. ID: " + tieuMucId);

            $.ajax({
                type: "GET",
                url: "/evaluation/getDanhGiaByTieuMucId",
                data: { id: tieuMucId },
                success: function(response) {
                    console.log("AJAX success. Response: ", response);
                    // Chỉ nạp nội dung cần thiết vào phần .modal-content của modal hiện có
                    $('#evaluationModal .modal-content').html(response);
                    $('#evaluationModal').modal('show');
                    console.log("Modal should be visible now.");
                },
                error: function(xhr, status, error) {
                    console.error("AJAX request error:", error);
                    console.error("Status:", status);
                    console.error("Response text:", xhr.responseText);
                    alert("Có lỗi xảy ra khi tải dữ liệu. Vui lòng thử lại sau.");
                }
            });
        });
        // Clear All button functionality
        $('#evaluationModal').on('click', '#clearAllBtn', function() {
            $('#evaluationModal').find('input[type="checkbox"]').prop('checked', false);
            $('#evaluationModal').find('input[type="file"]').val('');
        });

        // Select All button functionality
        $('#evaluationModal').on('click', '#selectAllBtn', function() {
            $('#evaluationModal').find('input[type="checkbox"]').prop('checked', true);
        });
    });
</script>

</body>

</html>
